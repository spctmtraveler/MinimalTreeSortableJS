ğŸ› ï¸ Oneâ€‘Page Fix Plan
Killâ€¯Dupes â€“â€¯one filter owner only
1.1 Remove/disable <script src="emergencyâ€‘fix.js"> and <script src="filterâ€‘fix.js">.
1.2 Keep only script.js; its handleFilterChange() will now run.

Timezoneâ€¯Proof â€“â€¯localâ€‘midnight parsing

js
Copy
Edit
// helpers.js (or top of script.js)
function parseDateLocal(iso) {
  // handles 'YYYYâ€‘MMâ€‘DD', full ISO, or empty
  if (!iso) return null;
  if (iso === 'today')     return today;
  if (iso === 'tomorrow')  return tomorrow;

  const datePart = iso.split('T')[0];                // strip time / Z
  const [y,m,d]  = datePart.split('-').map(Number);  // y=2025 m=07 d=25
  return new Date(y, m-1, d);                        // local midnight
}
function sameDay(a,b){
  return a.getFullYear()===b.getFullYear() &&
         a.getMonth()   ===b.getMonth()    &&
         a.getDate()    ===b.getDate();
}
FilterÂ Logic â€“â€¯central switch

js
Copy
Edit
const today    = new Date();                         // local now
const tomorrow = new Date(today); tomorrow.setDate(today.getDate()+1);

switch (filterValue) {

  case 'today': {
    const isToday   = sameDay(taskDate, today);
    const overdue   = taskDate < today && !isToday && !isCompleted;
    shouldShow      = isToday || overdue;
    break;
  }

  case 'tomorrow':
    shouldShow = sameDay(taskDate, tomorrow);
    break;

  case 'this-week': {
    const weekStart = new Date(today); weekStart.setDate(today.getDate()-today.getDay());
    const weekEnd   = new Date(weekStart); weekEnd.setDate(weekStart.getDate()+6);
    shouldShow = taskDate >= weekStart && taskDate <= weekEnd;
    break;
  }

  case 'triage': {
    const noDate    = !taskData.revisitDate && !isCompleted;
    const pastDue   = taskDate < today && !sameDay(taskDate,today) && !isCompleted;
    shouldShow      = noDate || pastDue;
    break;
  }

  /* â€¦nextâ€‘week, thisâ€‘month, nextâ€‘monthâ€¦ */
}
Every date arrives via const taskDate = parseDateLocal(taskData.revisitDate);

TriageÂ Rules â€“â€¯always visible

Unscheduled AND incomplete

Pastâ€‘due (before local today) AND incomplete

Manually placed tasks remain

ExportÂ Endpoint â€“â€¯wrong path

diff
Copy
Edit
- const response = await fetch('/api/debug/tasks');
+ const response = await fetch('/debug/tasks');
SmokeÂ Test â€“â€¯what to expect

Today shows â€œTodayÂ Aâ€, â€œTodayÂ Bâ€, â€œTodayÂ Câ€, plus any overdue.

Tomorrow shows â€œTomorrowÂ Aâ€ only.

Triage shows overdue + unscheduled.

Console logs reflect correct isToday / overdue / shouldShow.

Copyâ€‘paste checklist for dev:

 Delete emergencyâ€‘fix.js & filterâ€‘fix.js tags

 Add parseDateLocal() + sameDay()

 Replace date parsing & switch block as above

 Update export endpoint

 Rerun filters â€‘ confirm counts & logs

That single patch eliminates the UTC slip, prevents tomorrowâ€‘inâ€‘today, and guarantees Triage behaves as specified.